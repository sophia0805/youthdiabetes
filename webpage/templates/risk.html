<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Risk — YouthDiabetes.AI</title>
  <link rel="stylesheet" href="static/style.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <div class="logo"><a href="/"><img src="static/image/logo.png" alt="logo" style="width:28px;height:28px"></a></div>
        <div class="site-title">YouthDiabetes.AI</div>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/risk" class="active">Risk</a>
        <a href="/resources">Resources</a>
        <a href="/about">About</a>
      </nav>
      <button id="hamburger" class="hamburger" aria-label="Open menu">☰</button>
    </header>

    <section class="hero">
      <h1 style="text-align: center; font-size: 24px; margin-bottom: 16px;"> Evalute Your Risk Using Machine Learning</h1>
      <p style="text-align: center;">Our machine learning models were trained with the latest youth diabetes dataset published by Mount Sinai School of Medicine (2024). It is the most comprehensive dataset available for youth diabetes research. Our machine learning algrithms have been fine tuned to produce very high accuracy results.</p>
      <p style="text-align: center;font-size: 12px; color: red;">* risk prediction based on exising dataset, may have bias, please consult your healthcare provider for accurate diagnosis.</p>
      <p style="text-align: center;font-size: 12px;color: red;">** Our website won't store any of your information, no privacy concerns.</p>
      <div id="counter_text" style="text-align: center; font-size: 28px; margin-top: 16px;">
        <p font-size: 18px; ><strong>Fill Out Evaluation Form</strong></p>
         <form id="evaluationForm" style="text-align: center; margin-top: 16px; font-size: 12px;">
            <fieldset>
              <legend>Group 1 Factors</legend>
              <label for="age">Age:</label>
              <select id="age" name="age" required>
                <option value="">select an age</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>  
                <option value="17">17</option>
                <option value="18">18</option> 
                <option value="19">19</option>  
              </select><br>

              <label for="gender">Gender:</label>
              <select id="gender" name="gender" required>
                <option value="">select gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select><br>

              <label for="race">Race:</label>
              <select id="race" name="race" required>
                <option value="">select race</option>
                <option value="hispanic">Hispanic</option>
                <option value="non hispanic white">Non Hispanic White</option>
                <option value="non hispanic black">Non Hispanic Black</option>
                <option value="other">Other</option>
              </select><br>

              <label for="family_history">Family History of Diabetes:</label>
              <select id="family_history" name="family_history" required>
                <option value="1">Yes</option>
                <option value="0">No</option>
              </select><br>
            </fieldset> <br> <br>

            <fieldset>
              <legend>Group 2 Factors</legend>
              <label for="weight">weight(lb):</label>
              <select id="weight" name="weight" required>
                <option value="">select weight</option>
                <option value="60">50-70</option>
                <option value="80">71-90</option>
                <option value="100">91-110</option>
                <option value="120">111-130</option>
                <option value="120">131-150</option>
                <option value="150">151-170</option>
                <option value="170">171-200</option>
                <option value="200">201-230</option>
                <option value="250">231-270</option>
                <option value="270">271-300</option>
                <option value="300">300+</option>                 
              </select><br>
              <label for="height">height(inch):</label>
              <select id="height" name="height" required>
                <option value="">select height</option>
                <option value="50">45-55</option>
                <option value="60">56-65</option>
                <option value="70">66-75</option>
                <option value="80">76-85</option>
                <option value="90">86+</option>
              </select><br>
              <label for="Hypertension">Hypertension:</label>
              <select id="Hypertension" name="Hypertension" required>
                <option value="">select Hypertension</option>
                <option value="1">Yes</option>
                <option value="0">No</option>
              </select><br>
              <label for="Cholesterol">High Cholesterol:</label> 
              <select id="Cholesterol" name="Cholesterol" required>   
                <option value="">select Cholesterol</option>
                <option value="1">Yes</option>
                <option value="0">No</option>    
              </select><br>
              <label for="Physical_Activity">Physical Activity Per Week (hour):</label>
              <select id="Physical_Activity" name="Physical_Activity" required> 
                <option value="">select Physical Activity</option>
                <option value=0>0</option>
                <option value=1>1</option>
                <option value=2>2</option> 
                <option value=3>3</option>
                <option value=4>4</option>
                <option value=5>5</option>
                <option value=6>6</option>
                <option value=7>7</option>
                <option value=8>8+</option>
              </select><br>
              <label for="Screen_Time">Screen Time Per Day (hours):</label> 
              <select id="Screen_Time" name="Screen_Time" required>
                <option value="">select Screen Time</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option> 
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option> 
                <option value="19">19+</option>  
              </select><br>
            </fieldset> <br> <br>

            <fieldset>
              <legend>Group 3 Factors</legend>
              <label for="protein">Total protein intake in past 24 hours (oz):</label>
              <select id="protein" name="protein" required>
                <option value="">select Protein Intake</option>
                <option value="0">0</option>
                <option value="1">1-2</option>
                <option value="3">3-4</option>
                <option value="5">5-6</option>
                <option value="7">7-8</option>
                <option value="9">9-12</option>
                <option value="15">13-18</option>
                <option value="25">20-30</option>
                <option value="35">30-40</option>
                <option value="45">40-50</option>
                <option value="55">50-60</option>
                <option value="65">60-70</option>
                <option value="75">70+</option>
              </select><br>
              <label for="dairy">Total dairy intake in past 24 hours (cup):</label>
              <select id="dairy" name="dairy" required>
                <option value="">select Dairy Intake</option>
                <option value="0">0</option>
                <option value="0.25">0.5</option>
                <option value="1"> 1 </option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="5">4-6</option>
                <option value="8">7-9</option>
                <option value="11">9-13</option>
                <option value="16">14-18</option>
                <option value="20">19+</option>
              </select><br>
              <label for="grain">Total whole grain intake in past 24 hours (oz):</label>
              <select id="grain" name="grain" required> 
                <option value="">select Whole Grain Intake</option>
                <option value="0">0</option>
                <option value="1.5">1-2</option>
                <option value="3.5">3-4</option>
                <option value="5.5">5-6</option>
                <option value="7.5">7-8</option>
                <option value="10">9-12</option>
                <option value="15">13-18</option>
                <option value="25">20-30</option>
                <option value="35">30-40</option>
                <option value="45">40-50</option>
                <option value="50">50+</option>
              </select><br>
              <label for="fruit">Total fruit intake in the past 24 hours (cup):</label> 
              <select id="fruit" name="fruit" required>
                <option value="">select Fruit Intake</option>
                <option value="0">0</option>
                <option value="0.25">0.25-0.5</option>
                <option value="0.5">0.6-0.75</option>
                <option value="0.8">0.75-1</option>
                <option value="1.5">1-2</option>
                <option value="4">3-5</option>
                <option value="7">6-8</option>
                <option value="11">9-13</option>
                <option value="16">14-18</option>
                <option value="20">19+</option>
              </select><br>
              <label for="vegetable">Total Vegetable Intake in the past 24 hours (cup):</label> 
              <select id="vegetable" name="vegetable" required>   
                <option value="">select Vegetable Intake</option>
                <option value="0">0</option>
                <option value="0.25">0.25-0.5</option>
                <option value="0.5">0.6-0.75</option>
                <option value="0.8">0.75-1</option>
                <option value="1.5">1-2</option>
                <option value="4">3-5</option>
                <option value="7">6-8</option>
                <option value="11">9-13</option>
                <option value="13">14+</option>   
              </select><br>
            </fieldset> <br> <br>
            <input type="checkbox" name="option1" value="advanced"> Check the box if you want an advanced machine learning prediction by filling more information below<br><br>
            <fieldset>
              <legend>Group 4 Factors (optional) </legend>
              <label for="healthcond">Health condition:</label>
              <select id="healthcond" name="healthcond">
                <option value="0">Excellent</option>
                <option value="1">Good</option>
                <option value="2">Poor</option>
              </select><br>
              <label for="foodstamp">Food Stamps:</label>
              <select id="foodstamp" name="foodstamp">
                <option value="0">No</option>
                <option value="1">Yes</option>
              </select><br>
              <label for="eggs">Eggs intake past 24 hours (each):</label>
              <select id="eggs" name="egg">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2-3</option>
                <option value="3">4-5</option>
                <option value="6">6+</option>
              </select><br>
              <label for="poultry">Poultry intake past 24 hours (oz):</label>
              <select id="poultry" name="poultry">
                <option value="0">0</option>
                <option value="6">1-12</option>
                <option value="18">13-24</option>
                <option value="36">24-48</option>
                <option value="60">48-72</option>
                <option value="80">72+</option>
              </select><br>
              <label for="nuts">Nuts intake past 24 hours (oz):</label>
              <select id="nuts" name="nuts">
                <option value="0">0</option>
                <option value="2">1-3</option>
                <option value="6">4-8</option>
                <option value="11">9-12</option>
                <option value="18">13-24</option>
                <option value="25">24+</option>
              </select><br>
              <label for="milk">Milk intake past 30 days:</label>
              <select id="milk" name="milk">
                <option value="0">0</option>
                <option value="1">Rarely/less than once a week</option>
                <option value="2">Sometimes/once a week</option>
                <option value="3">Often/once a day or more</option>
              </select><br>
              <label for="solid_fat">Solid fat intake past 24 hours (gram):</label>
              <select id="solid_fat" name="solid_fat">
                <option value="0">0</option>
                <option value="25">1-50</option>
                <option value="75">51-100</option>
                <option value="150">101-200</option>
                <option value="250">201-300</option>
                <option value="300">300+</option>
              </select><br>
              <label for="oil">Oil intake past 24 hours (gram):</label>
              <select id="oil" name="oil">
                <option value="0">0</option>
                <option value="25">1-50</option>
                <option value="75">51-100</option>
                <option value="150">101-200</option>
                <option value="250">201-300</option>
                <option value="300">300+</option>
              </select><br>
              <label for="citrus">Citrus and melons and berries intake past 24 hours (cup):</label>
              <select id="citrus" name="citrus">  
                <option value="0">0</option>
                <option value="1.5">1-2</option>
                <option value="4">3-5</option>
                <option value="7">6-8</option>
                <option value="11">9-13</option>
                <option value="16">14+</option>
              </select><br>
            </fieldset> <br> <br>
            <button type="reset">Reset</button> 
            <button type="submit">Submit</button>
          </form>

      <div id="resultDiv" style="margin-top: 20px; text-align: center; color: green;"></div>

      <script type="text/javascript">
        document.getElementById('evaluationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            const race = document.getElementById('race').value;
            const family_history = document.getElementById('family_history').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('height').value;
            const Hypertension = document.getElementById('Hypertension').value;
            const Cholesterol = document.getElementById('Cholesterol').value;
            const Physical_Activity = document.getElementById('Physical_Activity').value;
            const Screen_Time = document.getElementById('Screen_Time').value;

            const protein = document.getElementById('protein').value;
            const dairy = document.getElementById('dairy').value;
            const grain = document.getElementById('grain').value; 
            const fruit = document.getElementById('fruit').value;
            const vegetable = document.getElementById('vegetable').value;

            const health_condition = document.getElementById('healthcond').value;
            const food_stamps = document.getElementById('foodstamp').value;
            const eggs = document.getElementById('eggs').value;
            const poultry = document.getElementById('poultry').value;
            const nuts = document.getElementById('nuts').value;
            const milk = document.getElementById('milk').value;
            const solid_fat = document.getElementById('solid_fat').value;
            const oil = document.getElementById('oil').value;
            const citrus = document.getElementById('citrus').value;

            const evaluationData = { age, gender, race, family_history, weight, height, Hypertension, Cholesterol, Physical_Activity, Screen_Time, protein, dairy, grain, fruit, vegetable, health_condition, food_stamps, eggs, poultry, nuts, milk, solid_fat, oil, citrus };

            //alert('Submitting evaluation data: ' + JSON.stringify(evaluationData));
            document.getElementById('resultDiv').innerHTML = '<p style="text-align: center; color: red;">running machine learning model, please wait...</p>';

            try {
                const response = await fetch('https://www.youthdiabetes.ai/api/evaluate',  {                           
                //const response = await fetch('http://localhost:3000/api/evaluate', {
                //const response = await fetch('https://youthdiabetes-ai.onrender.com/api/evaluate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(evaluationData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const resultDiv = document.getElementById('resultDiv');
                //alert('Received result: ' + JSON.stringify(result));
                
                if (result.success) {
                    const evaluationResult = typeof result.evaluation_result === 'string'
                        ? result.evaluation_result
                        : result.evaluation_result; // Keep as object if needed

                    // Check if probability is greater than 50%
                    if (evaluationResult.risk_level == "High" ) {
                        resultDiv.innerHTML = `<span style='color: red;'>Risk Level: High</span><br>
                                              <span style='color: red;'>Probability: ${evaluationResult.probability}%</span><br><br>
                                              <strong>Risk Factors:</strong><br>`;

                        // List all risk factors, how to add font size and line break
                        evaluationResult.risk_factors.forEach(factor => {
                            resultDiv.innerHTML += `<span style="font-size: 16px;">${factor}</span><br>`;
                        });

                        //create a hiden element for recommandaton generation
                        const hiddenElement = document.createElement('risk_level');
                        hiddenElement.id = 'risk_level';
                        hiddenElement.style.display = 'none';
                        hiddenElement.value = 'High';
                        document.body.appendChild(hiddenElement);
                    } 
                    else if (evaluationResult.risk_level == "Low") {
                                              resultDiv.innerHTML = `<span >Risk Level: Low</span><br>
                                              <span style='color: red;'>Probability: ${evaluationResult.probability}%</span><br><br>
                                              <strong>Risk Factors:</strong><br>`;

                        // List all risk factors, how to add font size and line break
                        evaluationResult.risk_factors.forEach(factor => {
                            resultDiv.innerHTML += `<span style="font-size: 16px;">${factor}</span><br>`;
                        });

                                                //create a hiden element for recommandaton generation
                        const hiddenElement = document.createElement('risk_level');
                        hiddenElement.id = 'risk_level';
                        hiddenElement.style.display = 'none';
                        hiddenElement.value = 'Low';
                        document.body.appendChild(hiddenElement);

                    }else {
                        resultDiv.innerHTML = `<span >Risk Level: Medium</span><br>
                                               <strong>Risk Factors:</strong><br>`;
                        // List all risk factors, how to add font size and line break
                        evaluationResult.risk_factors.forEach(factor => {
                            resultDiv.innerHTML += `<span style="font-size: 16px;">${factor}</span><br>`;
                        });

                        const hiddenElement = document.createElement('risk_level');
                        hiddenElement.id = 'risk_level';
                        hiddenElement.style.display = 'none';
                        hiddenElement.value = 'Medium';
                        document.body.appendChild(hiddenElement);

                    }
                } else {
                    resultDiv.innerHTML = `Error: ${result.error}`;
                }
            } catch (error) {
                console.error('Error:', error.message);
                const resultDiv = document.getElementById('resultDiv');
                resultDiv.innerHTML = `Error submitting report!`;
            }
        });
      </script>
      </div>
     </section>

    <section class="hero">
      <h1 style="text-align: center; font-size: 24px; margin-bottom: 16px;"> Generate Recommendations Using Generative AI</h1>
      <p style="text-align: center;">We use Generative AI to produce personalized recommendations based on your risk factors. It helps you to reduce the risk of developing diabetes.</p>
      <div id="counter_text" styl="text-align: center; font-size: 28px; margin-top: 16px; color:red">
        <p style="text-align: center;"><input type="submit" id="generateRecommendations" value="Generate Recommendations"> </p> 
      </div>
     </section>

     <div class="markdown-body" id="managementPlan" style="margin-top: 12px; text-align: left;"></div>
        <script>
          document.getElementById('generateRecommendations').addEventListener('click', async (event) => {
            event.preventDefault(); // Prevent default form submission

            const prompt = generatePrompt();

            if(!prompt) {
              return; // Exit if prompt generation failed
            }

            //alert('before call API ${prompt} ');   
            document.getElementById('managementPlan').innerHTML='<p style="text-align: center; color: red;">Generating recommendations, please wait 1-2 minutes...</p>';

            try {
              //alert('before call API' + prompt);
              const response = await fetch('https://www.youthdiabetes.ai/api/chat', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({ prompt: prompt })
              });
              
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }

              const data = await response.json();
              //alert('after call API ' + JSON.stringify(data));
              const plan = data.reply;
              //const plan = data.choices[0].message.content;

              document.getElementById('managementPlan').innerHTML = marked.parse(plan); // Use Marked.js to parse markdown to HTML
              //document.getElementById('managementPlan').innerHTML = `<strong>Personalized Recommendations:</strong><br>${plan}`;
            } catch (error) {
              alert('An error occurred while generating recommendations. Please try again.' + error);
              console.error('Error:', error);
              document.getElementById('managementPlan').textContent = 'Failed to generate a management plan. Please try again.';
            }
          });

          function generatePrompt() {

              let prompt= `Generate recommendations to reduce diabetes risk with detailed physical activity and diet plan for a person with the following information:`;
              const age = document.getElementById('age').value;
              const gender = document.getElementById('gender').value;
              const familyHistory = document.getElementById('family_history').value;

              if(age === "" || gender === "" || familyHistory === "") {
                alert("Please fill in Age, Gender and Family History to generate recommendations.");
                return;
              }
              const weight = document.getElementById('weight').value;
              const height = document.getElementById('height').value;

              if (weight === "" || height === "") {
                  alert("Please fill in both weight and height to calculate BMI.");
                 return;
              }
              const Hypertension = document.getElementById('Hypertension').value;
              const Cholesterol = document.getElementById('Cholesterol').value;
              const Physical_Activity = document.getElementById('Physical_Activity').value;
              const Screen_Time = document.getElementById('Screen_Time').value;

              const protein = document.getElementById('protein').value;
              const dairy = document.getElementById('dairy').value;
              const grain = document.getElementById('grain').value; 
              const fruit = document.getElementById('fruit').value;
              const vegetable = document.getElementById('vegetable').value;

              const riskLevelElement = document.getElementById('risk_level');
              if (riskLevelElement) {
                  const riskLevel = riskLevelElement.value;
                  prompt += `\n- Diabetes Risk Level: ${riskLevel}`;
              } 

              prompt += `\n- Age: ${age}`;
              prompt += `\n- Gender: ${gender}`;
              prompt += `\n- Family History of Diabetes: ${familyHistory}`;

              //calculate BMI
              const weightNum = parseFloat(weight);
              const heightNum = parseFloat(height);
              const bmi = weightNum / (heightNum ** 2) * 703;
              if(bmi > 30) {
                prompt += `\n- BMI: ${bmi.toFixed(2)} (Obese)`;
              } 

              if(Hypertension === '1' ) {        
                prompt += `\n- Hypertension: 'Yes'`;
              }

              if (Cholesterol === '1') {
                prompt += `\n- High Cholesterol:  'Yes'`;
              }

              if(Physical_Activity < 3.5) {
                prompt += `\n- Low Physical Activity'`;
              }

              if(Screen_Time > 5) {
                prompt += `\n- too much Screen Time'`;
              } 

              prompt += `\n- Total protein intake in past 24 hours (oz): ${protein}`;
              prompt += `\n- Total dairy intake in past 24 hours (cup): ${dairy}`;
              prompt += `\n- Total whole grain intake in past 24 hours (oz): ${grain}`;
              prompt += `\n- Total fruit intake in the past 24 hours (cup): ${fruit}`;
              prompt += `\n- Total Vegetable Intake in the past 24 hours (cup): ${vegetable}`;
                       
              return prompt;
            }

        </script>
   <p class="footer">© 2026 youthdiabetes.ai — style-only demo</p>
  </div>
  <div id="drawer" class="drawer" aria-hidden="true"><div class="panel">
    <a href="/">Home</a>
    <a href="/risk">Risk</a>
    <a href="/resources">Resources</a>
    <a href="/about">About</a>
  </div></div>
  <script src="../js/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>